/* Cognizant Challenge - Created by Saurabh Nemade. Email : harsh0707051mail@gmail.com 
  cognizant-challenge - v1.0.0 
  2016-10-01*/

Ext.application({name:"CodeCafe",launch:function(){Ext.create("CodeCafe.view.main.Main",{loggedInUser:"Saurabh Nemade"}).show()}}),Ext.define("CodeCafe.store.Stats",{extend:"Ext.data.Store",alias:"store.stats",storeId:"stats",autoLoad:!0,proxy:{reader:{type:"json",rootProperty:"data",totalProperty:"totalCount"},type:"ajax",api:{read:"/getStats"}}}),Ext.define("CodeCafe.store.Websites",{extend:"Ext.data.Store",alias:"store.websites",storeId:"websites",fields:[{name:"id",type:"string"},{name:"source_code",type:"string",convert:function(a,b){return Ext.util.Format.htmlEncode(b.get("source_code"))}},{name:"editorLang",type:"string",convert:function(a,b){switch(b.get("language")){case"GNU C++":case"GNU C++11":case"MS C++":case"GNU C":case"GNU C11":return"c_cpp";case"Mono C#":case"MS C#":return"csharp";case"Python 3":case"Python 2":case"PyPy 2":case"PyPy 3":return"python";case"FPC":return"javascript";case"Java 7":case"Java 8":return"java";case"Delphi":return"c_cpp";case"Ruby":return"ruby";case"PHP":return"php";case"JavaScript":return"javascript";case"D":return"d";case"Haskell":return"haskell";case"Scala":return"scala";case"Ocaml":return"ocaml";case"Perl":return"perl";case"Go":return"golang";default:return"javascript"}}}],autoLoad:!0,pageSize:3,remoteFilter:!0,proxy:{reader:{type:"json",rootProperty:"data",totalProperty:"totalCount"},type:"ajax",api:{read:"/getWebsites"},extraParams:{accepted:!1,skipped:!1,memory:!1,runtime:!1,wrong:!1,searchTerm:""}},listeners:{load:function(a,b){setTimeout(function(){for(var b=0;b<a.getCount();b++){var c=a.getAt(b).get("id"),d="ace/mode/"+a.getAt(b).get("editorLang");try{var e=ace.edit("programContent"+c);e.setTheme("ace/theme/github"),e.getSession().setMode(d),e.setOptions({readOnly:!0})}catch(a){console.log(a)}}},500)}}}),Ext.define("CodeCafe.view.dashboard.Dashboard",{extend:"Ext.panel.Panel",xtype:"dashboard",layout:"fit",items:[{layout:"hbox",flex:4,items:[{xtype:"results",flex:3},{xtype:"tools",flex:1}]}]}),Ext.define("CodeCafe.view.main.Main",{extend:"Ext.container.Viewport",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",title:'<div class="siteImage"></div><div class="titleTextPadding"><span class="bigText"><span class="green">&nbsp;&nbsp;C</span>ode <span class="green">C</span>afe</span><span class="smallText"> - code hub with stats!</span></div>',cls:"titleHeader",items:[{xtype:"dashboard"}],tools:[{xtype:"button",iconCls:"fa fa-user",text:a.loggedInUser},{xtype:"button",iconCls:"fa fa-info-circle",margin:5,menu:[{xtype:"menuitem",text:"LinkedIn",iconCls:"fa fa-linkedin",clickLink:"https://www.linkedin.com/in/saurabh-nemade-a87b4151",handler:function(){var a=window.open(this.clickLink,"_blank");a.focus()}},{xtype:"menuitem",text:"Facebook",iconCls:"fa fa-facebook",clickLink:"https://www.facebook.com/saurabh.nemade",handler:function(){var a=window.open(this.clickLink,"_blank");a.focus()}},{xtype:"menuitem",text:"Instagram",iconCls:"fa fa-instagram",clickLink:"https://www.instagram.com/saurabh.nemade/",handler:function(){var a=window.open(this.clickLink,"_blank");a.focus()}}]}]}]}),this.callParent(arguments)}}),Ext.define("CodeCafe.view.results.ResultController",{extend:"Ext.app.ViewController",alias:"controller.resultController",onClearClick:function(){var a=this.lookupReference("searchTerm");a.reset();var b=Ext.getStore("websites");b.getProxy().extraParams.searchTerm="",b.load()},onSearchClick:function(){var a=this.lookupReference("searchTerm"),b=Ext.getStore("websites");b.getProxy().extraParams.searchTerm=a.getValue(),b.load()}}),Ext.define("CodeCafe.view.results.Results",{extend:"Ext.panel.Panel",xtype:"results",layout:"fit",controller:"resultController",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},minHeight:400,defaults:{height:"100%",padding:{left:15,right:15}},bodyStyle:{"background-color":"whitesmoke"},items:[{xtype:"snippet",store:Ext.create("CodeCafe.store.Websites"),listeners:{afterrender:function(a){a.setHeight(window.innerHeight-170)}}}]}],bbar:[{xtype:"pagingtoolbar",width:"100%",listeners:{afterrender:function(a){a.setStore(Ext.StoreMgr.get("websites"))}}}],tbar:[{xtype:"textfield",emptyText:"Search (by title, level or language)",width:"100%",reference:"searchTerm",triggers:{clear:{cls:"x-form-clear-trigger",handler:"onClearClick"},search:{cls:"x-form-search-trigger",handler:"onSearchClick"}}}]}),Ext.define("CodeCafe.view.snippet.Snippet",{extend:"Ext.view.View",xtype:"snippet",cls:"snippets",overflowY:"scroll",tpl:["<div>",'<tpl for=".">','<div class="snippetItem">','<div class="title">','<img src="resources/c.png" width="40px" height="40px">','<span class="programTitle">{title}</span>','<span class="right"><tpl if="compiler_status === \'Accepted\'"><i class="fa fa-check-circle"></i><tpl else><i class="fa fa-times-circle"></i></tpl> {compiler_status} | {language}</span>',"</div>",'<div class="content">','<div class="codeBox" id="programContent{id}">',"{source_code}","</div>",'<div class="topRight">',"</div>","</div>","</div>","</tpl>","</div>"],itemSelector:".snippets div.snippetItem"}),Ext.define("CodeCafe.view.tools.stats",{extend:"Ext.view.View",xtype:"stats",autoScroll:!0,cls:"stats",itemSelector:".stats div.statEl",tpl:["<div>",'<tpl for=".">','<div class="statEl>',"<h3>Top 5 Languages Used:</h3>",'<tpl for="languages">','<div><span class="bold">{name}:</span>{count}</div>',"</tpl>","<h3>Top 2 submissions accepted</h3>",'<tpl for="accepted">',"<div>{name}</div>","</tpl>","<h3>Number of Submissions per level</h3>",'<tpl for="level">','<div><span class="bold">{name}:</span>{count}</div>',"</tpl>","<h3>Total Submissions:<sub></sub>{submission}</h3>","</div>","</tpl>","</div>"]}),Ext.define("CodeCafe.view.tools.Tools",{extend:"Ext.panel.Panel",xtype:"tools",layout:"fit",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:4,items:[{xtype:"panel",title:"Filter by status",titleAlign:"center",iconCls:"fa fa-filter",collapsible:!0,flex:1,items:[{xtype:"panel",defaultType:"checkboxfield",padding:10,border:1,items:[{boxLabel:"Accepted",name:"statusCheckBox",listeners:{change:function(a){a.getValue()===!0?Ext.getStore("websites").getProxy().extraParams.accepted=!0:Ext.getStore("websites").getProxy().extraParams.accepted=!1,Ext.getStore("websites").load()}}},{boxLabel:"Skipped",name:"statusCheckBox",listeners:{change:function(a){a.getValue()===!0?Ext.getStore("websites").getProxy().extraParams.skipped=!0:Ext.getStore("websites").getProxy().extraParams.skipped=!1,Ext.getStore("websites").load()}}},{boxLabel:"Memory / Time limit exceeded",name:"statusCheckBox",listeners:{change:function(a){a.getValue()===!0?Ext.getStore("websites").getProxy().extraParams.memory=!0:Ext.getStore("websites").getProxy().extraParams.memory=!1,Ext.getStore("websites").load()}}},{boxLabel:"Runtime / Compilation error",name:"statusCheckBox",listeners:{change:function(a){a.getValue()===!0?Ext.getStore("websites").getProxy().extraParams.runtime=!0:Ext.getStore("websites").getProxy().extraParams.runtime=!1,Ext.getStore("websites").load()}}},{boxLabel:"Wrong Answer",name:"statusCheckBox",listeners:{change:function(a){a.getValue()===!0?Ext.getStore("websites").getProxy().extraParams.wrong=!0:Ext.getStore("websites").getProxy().extraParams.wrong=!1,Ext.getStore("websites").load()}}}]}]},{xtype:"panel",title:"Statistical Analysis",titleAlign:"center",iconCls:"fa fa-list-ol",collapsible:!0,flex:1,items:[{xtype:"panel",padding:10,items:[{xtype:"stats",store:Ext.create("CodeCafe.store.Stats")}]}]}]}]});